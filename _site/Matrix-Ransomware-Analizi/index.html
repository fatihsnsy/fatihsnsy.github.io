<!DOCTYPE html> <html lang="tr-TR"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Fatih Şensoy" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Fatih Şensoy" /> <title> Matrix Ransomware Analizi (Giriş Seviye) - Fatih Şensoy </title> <link rel="alternate" href="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" hreflang="tr-TR" /> <link rel="canonical" href="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta name="description" content="Matrix Ransomware, dünyada bir çok türevi bulunan bir fidye yazılımıdır. Bizim incelediğimiz türev başka hiçbir yerde incelenmemiştir. “.eman” uzantısında dosyaları kriptolamaktadır." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Matrix Ransomware Analizi (Giriş Seviye) | " /> <meta property="og:title" content="Matrix Ransomware Analizi (Giriş Seviye) | " /> <meta property="og:type" content="website" /> <meta property="og:url" content="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta property="og:description" content="Matrix Ransomware, dünyada bir çok türevi bulunan bir fidye yazılımıdır. Bizim incelediğimiz türev başka hiçbir yerde incelenmemiştir. “.eman” uzantısında dosyaları kriptolamaktadır." /> <meta property="og:image" content="https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Matrix Ransomware Analizi (Giriş Seviye) | fatihsnsy" /> <meta name="twitter:url" content="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta name="twitter:site" content="@fatihsnsy" /> <meta name="twitter:creator" content="@fatihsnsy" /> <meta name="twitter:description" content="Matrix Ransomware, dünyada bir çok türevi bulunan bir fidye yazılımıdır. Bizim incelediğimiz türev başka hiçbir yerde incelenmemiştir. “.eman” uzantısında dosyaları kriptolamaktadır." /> <meta name="twitter:image" content="https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png" /> <link type="application/atom+xml" rel="alternate" href="https://fatihsensoy.com/feed.xml" title="Fatih Şensoy" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/fav-32.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Matrix Ransomware Analizi (Giriş Seviye) | Fatih Şensoy</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="Matrix Ransomware Analizi (Giriş Seviye)" /> <meta name="author" content="Fatih ŞENSOY" /> <meta property="og:locale" content="tr_TR" /> <meta name="description" content="Matrix Ransomware, dünyada bir çok türevi bulunan bir fidye yazılımıdır. Bizim incelediğimiz türev başka hiçbir yerde incelenmemiştir. “.eman” uzantısında dosyaları kriptolamaktadır." /> <meta property="og:description" content="Matrix Ransomware, dünyada bir çok türevi bulunan bir fidye yazılımıdır. Bizim incelediğimiz türev başka hiçbir yerde incelenmemiştir. “.eman” uzantısında dosyaları kriptolamaktadır." /> <link rel="canonical" href="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta property="og:url" content="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta property="og:site_name" content="Fatih Şensoy" /> <meta property="og:image" content="https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-12-30T15:20:00+00:00" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png" /> <meta property="twitter:title" content="Matrix Ransomware Analizi (Giriş Seviye)" /> <script type="application/ld+json"> {"@type":"BlogPosting","image":"https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png","headline":"Matrix Ransomware Analizi (Giriş Seviye)","dateModified":"2019-12-30T15:20:00+00:00","datePublished":"2019-12-30T15:20:00+00:00","url":"https://fatihsensoy.com/Matrix-Ransomware-Analizi/","mainEntityOfPage":{"@type":"WebPage","@id":"https://fatihsensoy.com/Matrix-Ransomware-Analizi/"},"author":{"@type":"Person","name":"Fatih ŞENSOY"},"description":"Matrix Ransomware, dünyada bir çok türevi bulunan bir fidye yazılımıdır. Bizim incelediğimiz türev başka hiçbir yerde incelenmemiştir. “.eman” uzantısında dosyaları kriptolamaktadır.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Anasayfa</a><a class="menu-link" href="/archive/">Arşiv</a><a class="menu-link" href="/about/">Hakkımda</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="main_wrapper"> <div class="toc_wrapper"> <div class="toc_content"> <h2>İçerik</h2> <ul><li><a href="#i̇lk-bakış">İlk Bakış</a></li><li><a href="#statik-analiz">Statik Analiz</a></li><li><a href="#derinlere-i̇nelim">Derinlere İnelim</a></li><li><a href="#cff-explorer">CFF Explorer</a></li><li><a href="#dinamik-analize-geçelim">Dinamik Analize Geçelim</a></li><li><a href="#sonsöz">Sonsöz</a></li></ul> </div> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"></article> <header class="header"> <img src="/assets/img/matrix-ransomware-analizi/img/cover.png" alt="" style="border: 2px solid white; width: 100%;"><br><br> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#malware">MALWARE</a>, <a class="tag" href="/tags/#malware-analysis">MALWARE ANALYSIS</a>, <a class="tag" href="/tags/#matrix-ransomware">MATRIX RANSOMWARE</a> </span> </div> <h1 class="header-title" itemprop="headline">Matrix Ransomware Analizi (Giriş Seviye)</h1> <div class="post-meta"> <time datetime="2019-12-30T15:20:00+00:00" itemprop="datePublished"> Dec 30, 2019 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Fatih ŞENSOY</span> </span> <time hidden datetime="" itemprop="dateModified"> Dec 30, 2019 </time> <span hidden itemprop="publisher" itemtype="Person">Fatih ŞENSOY</span> <span hidden itemprop="image">/assets/img/matrix-ransomware-analizi/img/cover.png</span> <span hidden itemprop="mainEntityOfPage"><p>Selamlar herkese. Matrix Ransomware analiz raporumu sizlere paylaşıyorum. Bu benim Malware Analistliği kariyerimde yazdığım ilk raporum ünvanını taşıyor. Diğerlerini de belirli aralıklarla sizlerle paylaşmayı düşünüyorum :)</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>Selamlar herkese. Matrix Ransomware analiz raporumu sizlere paylaşıyorum. Bu benim Malware Analistliği kariyerimde yazdığım ilk raporum ünvanını taşıyor. Diğerlerini de belirli aralıklarla sizlerle paylaşmayı düşünüyorum :)</p> <p>Matrix Ransomware, dünyada bir çok türevi bulunan bir fidye yazılımıdır. Bizim incelediğimiz türev başka hiçbir yerde incelenmemiştir. “.eman” uzantısında dosyaları kriptolamaktadır.</p> <table> <thead> <tr> <th style="text-align: center">SHA-256</th> <th style="text-align: center">MD5</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">242713ef2f372f0d39ca8f01bd09c9f99bcfe850e156621c023dd9e0bfb9bd95</td> <td style="text-align: center">A93BD199D34D21CC9102600C6CE782CF</td> </tr> </tbody> </table> <h3 id="i̇lk-bakış"> <a href="#i̇lk-bakış" class="anchor-head"></a> İlk Bakış </h3> <p><strong>MatrixRansomware.exe</strong> isimli dosyanın orijinal adı <strong>eman33.exe</strong> olarak internet ortamında dolaşıyor. MatrixRansomware’ın farklı farklı türevleri mevcut ve sürekli gelişim halinde. Ben analizde anlaşılması adına ismini düzenledim. Şimdi ilk olarak bu ransomware’ın yeteneklerini görmek için gelin bir laboratuvar ortamımızda test edelim.</p> <p>Öncelikle MatrixRansomware.exe isimli dosyamızı kullanıcı yetkilerinde çalıştırıyoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-1.png" alt="Matrix Ransomware İlk Bakış" /></p> <p>Çalıştırdığımızda masaüstümüzde dosyalar oluştuğunu ve iki adet komut satırı ekranı açıldığını görüyoruz. Laboratuvar ortamımız ağa bağlı.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-2.png" alt="Matrix Ransomware İlk Açılış" /></p> <p>Görüldüğü üzere öne çıkan komut satırının en üstünde SHARESSCAN ibaresi yer alıyor. Yani şuan paylaşılan klasörleri geziyor. Ağımızdaki diğer bilgisayarlara ulaşmak için IP bloğumuzdan hareket ediyor. Diğer Command Line penceremizde ise bazı bilgilerin yer aldığını görüyoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-3.png" alt="Matrix Ransomware İlk Tetikleme" /></p> <p>Integrity seviyesini numaralandırdığını görüyoruz ve şuan da 3 seviyesinde. Yani program USER yetkilerinde çalışıyor. </p> <p>LDRIVES kısmına baktığımızda ise C: dizinini direk olarak hedef aldığını görüyoruz. Ve dosyalarımızı kriptolarken anlık olarak sistemimizin performansına göre kriptolama hızını gösteren bir ibare de mevcut.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-4.png" alt="Matrix Ransomware Kullanıcı Yetkilerinde Oluşturulan Dosyalar" /></p> <p>Masaüstüne kullanıcı yetkilerinde iken oluşturduğu dosyalar görselde mevcuttur.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-5.png" alt="Matrix Ransomware elog Dosya İçeriği" /></p> <p><strong>elog_0940325A9D85363B.txt</strong> dosyasını açtığımızda ise logları görüyoruz. Ransomware’ımız kullanıcı yetkilerinde olduğu için dosyalara erişememiş ve bir şifreleme yapamamış.</p> <p>Şimdi ise Admin yetkilerinde malware’imizi çalıştıralım.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-6.png" alt="Matrix Ransomware Admin Yetkileri" /></p> <p>Yine aynı işlemleri yaptı ve komut ekranı kapandı. Kapanırken ise işlemin tamamlandığına dair bir bilgi verdi. Masaüstünde yine birkaç dosya oluşturdu ama bu sefer dosyalarımızı kriptolamıştı ve **#README_EMAN#.rtf **adında bir dosya oluşturmuştu.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-7.png" alt="Matrix Ransomware Admin Yetkilerinde Oluşturulan Dosyalar" /></p> <p>Dosyayı açtığımızda bize, dosyalarımızı nasıl kurtaracağımıza dair bir yönerge gösteriyordu. Saldırgan ile nasıl iletişime geçileceğinin bilgisi mevcuttu. Hatta güven sağlamak için saldırganlara yollayacağımız 3 adet kriptolanmış veriyi decrypt edip geri vereceklerini söylüyorlardı.</p> <p>İlk bakışımız bu şekilde sona erdi. Zararlı yazılımın ne yaptığı hakkında genel bir bilgi sahibi olduk. Şimdi ise bir sonraki adımımıza, yani STATİK ANALİZE geçelim.</p> <h3 id="statik-analiz"> <a href="#statik-analiz" class="anchor-head"></a> Statik Analiz </h3> <p>IDA ile statik analizimizi yapıyoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-8.png" alt="IDA İlk Bakış" /></p> <p>Herhangi bir main fonksiyonunun olmadığını görüyoruz. Aslında var ama malware’ı geliştiren kişiler analizi zorlaştırmak için adını değiştirmiş veya malware’i packlemiş olabilirler. Pack detection toolları ile tarama yapıldığında da herhangi bir pack işleminin olmadığını gördük. Malware’ın <strong>3700</strong>’den fazla fonksiyonu mevcut.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-9.png" alt="Matrix Ransomware Hex Ve String" /></p> <p>Statik analize devam ettiğimizde ise Strings ve Hex Görüntüsü pencerelerine göz attığımızda ise bazı kritik bulgulara ulaşıyoruz. Bunlar indikatörlere ulaşmamızı sağlayacak.</p> <p>Bulunan Kritik Ve Önemli Bulgular</p> <ul> <li>Varolan işlemlerin diline bakarak kullanıcının sisteminin dilini öğrenmeye çalışıyor.</li> <li>WSAStartup, bind, accept, connect gibi parametreler Soket Programlama’dan tanıdık geliyor. Yani bu malware bir uzak sunucu ile bağlantı kuruyor.</li> <li>Listen, accept ve send parametleri de mevcut. Hem veri alıyor, hem de veri gönderimi yapıyor.</li> <li>Basic seviyede Proxy-Authorization mekanizması kullanıyor.</li> </ul> <p>Şimdi ise bu malware’ın neleri import ettiğine bakıyoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-10.png" alt="Matrix Ransomware Importlar" /></p> <p><strong>Kernel32</strong> ve <strong>wsock32</strong> gibi kritik kütüphaneleri kullanıyor. Wsock32 kütüphanesi import etmesinden de anlayabileceğimiz üzere bir sunucu ile iletişimde olduğu bulgularımızı doğrulamış olduk. Kütüphanelerden ise kullandığı fonksiyonlara göz atalım.</p> <p><strong>DeleteFileW</strong> fonksiyonunu dahil etmiş. Yani mesajda bize verdiği <strong>7 günlük</strong> sürenin sonunda iletişime geçilmezse gerçekten de şifrelenmiş dosyaları siliyor.</p> <p><strong>CreateMutexW</strong> fonksiyonu ile de Mutex mekanizması kullanıyor. Yani Mutex’i C dilinde yazıp çalıştırırsak, malware “Mutex var ise çalışma” prensibinden dolayı bir daha çalıştırırsak sistemi şifrelemeyecek.</p> <p><strong>CryptGenRandom</strong> fonksiyonu ile de bir arabelleği kriptografik baytlar ile dolduruyor.</p> <h3 id="derinlere-i̇nelim"> <a href="#derinlere-i̇nelim" class="anchor-head"></a> Derinlere İnelim </h3> <p>IDA ile biraz daha ayrıntıya iniyoruz. <strong>FindFirstFileW</strong> fonksiyonu ile belirli bir uzantıdaki dosyaları aradığını anlıyoruz. Biraz daha derin analiz yapıldığında ransomware’in kriptoladığı uzantılar aşağıdaki gibidir:</p> <ul> <li>.cmd</li> <li>.bat</li> <li>.vbs</li> <li>.ink</li> <li>.rtf</li> <li>.bmp</li> <li>.tmp</li> </ul> <p>32-bit ve 64-bit sistemler için ayrı ayrı işlemler yapıyor.</p> <p>Disassembly kodlarında** log.txt**’nin de oluşturulduğunu görüyoruz.</p> <p><strong>nw.exe</strong> adlı programın –n parametresi ile bir işlem yapıyor ve nw.exe ağ ve Javascript kütüphaneleri içeren bir program olarak biliniyor. Genelde adware yazılımlar için kullanılıyor.</p> <p>“%d.%d.%d.%d” ile aynı ağda bulunan diğer sistemleri tarayarak IP adreslerini CMD ekranında kullanıcıya gösteriyor.</p> <p>80, 443, 21 gibi portlar da zararlıya tanımlanmış.</p> <p>Malware, bulaşma zamanlarını hesaplayarak 7 günlük silme sürecini başlatıyor. Bilgisayarın ve mevcut kullanıcının adını da tanımlama yapmak amacıyla alıyor. flcCipherRSA ibaresinden dosyaların RSA ile kriptolandığını anlıyoruz.</p> <p>Ayrıca bir URL’e HTTP verisi gönderildiğini tespit ettim. HTTP başlıklarını ayarlıyor. “<strong>set-cookie, Content-Lenght, Content-Type</strong>” gibi standart HTTP Head bilgilerini de yolluyor. Cookie set etmesinden bir kullanıcı tanımlama mekanizması yaptığı ihtimali güçleniyor.</p> <p>Komuta kontrol sunucusuna (URL’e) yolladığı parametreler ise dikkat çekici:</p> <ul> <li>/addrecord.php?apikey=</li> <li>&amp;compuser=</li> <li>&amp;sid=</li> <li>&amp;phase=</li> </ul> <p>Ardı ardına birleştirme operatörünü kullanarak (&amp;) bir istek gönderiyor. Burada da her kullanıcıyı tanımlamak için bir mekanizma oluşturduğu ihtimalini kanıtlamış oluyoruz.</p> <p>Ayrıca user-agent olarak “<strong>Mozilla/4.0 (compatible; Synapse)</strong>” ayarlıyor.</p> <h3 id="cff-explorer"> <a href="#cff-explorer" class="anchor-head"></a> CFF Explorer </h3> <p>Daha iyi analizle yapmak için CFF Explorer’da da analiz ediyoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-11.png" alt="CFF Explorer İlk Bakış" /></p> <p>Section Headers’lara baktığımızda standart MZ başlığı yerine <strong>MZP</strong> başlığını görüyoruz. Yani bu ransomware <strong>Pascal</strong> ile yazılmış!</p> <p>Analizin geçen kısımlarında ise Borland Delphi 3.0 IDE’sini kullandığını da tespit etmiştik.</p> <p>Import Directory’ye geldiğimizde ise malware’ın etkisini ciddi derecede görebiliyoruz. Import ettiği dll’ler ve fonksiyonlarında kritik seviyede bulunanlar şu şekilde:</p> <ul> <li>GetSystemInfo</li> <li>GetProcAddress</li> <li>CreateThread</li> <li>CreateMutexW</li> <li>GetVolumeInformationW</li> <li>GetDiskFreeSpace</li> <li>DeleteFileW</li> <li>gethostname</li> <li>gethostbyname</li> </ul> <p>Yukarıdaki fonksiyonlara baktığımızda;</p> <ul> <li>sistemin bilgilerini alabildiği,</li> <li>bir işlemin adresini alabildiği,</li> <li>bir iş parçacığı oluşturabildiği,</li> <li>bir Mutex nesnesi oluşturabildiği,</li> <li>Dosya sistemi ve hacmine erişebildiği,</li> <li>Boş alana erişebildiği,</li> <li>Ve en kritiği olan DOSYALARI SİLEBİLDİĞİ gözlemlenmiştir.</li> </ul> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-12.png" alt="Matrix Ransomware Resource" /></p> <p>Dosyanın içindeki kaynaklarda ise iki kısmın olduğu tespit edilmiştir. Strings Tables ve RCData. Strings Tables’da ayların isimleri vs. olduğu gözlemlenmiştir. RCData kısmında ise farklı farklı kaynaklar olduğu görülmektedir.</p> <p>Fakat erişilmeye çalışıldığında bozuk bir ASCII çıktısı bizi karşılamaktadır. Buradan yapılan çıkarımla <strong>RCData</strong> kaynağının içinde çok önemli bilgilerin olduğu ve okunamaması için de özel bir şifreleme türü ile şifrelendiği ortaya çıkmaktadır.</p> <h3 id="dinamik-analize-geçelim"> <a href="#dinamik-analize-geçelim" class="anchor-head"></a> Dinamik Analize Geçelim </h3> <p>Statik analizde bir çok önemli veriyi ele geçirmeyi başardık. Şimdi ise bize kritik bilgileri verecek olan, bir Malware Analizinin olmazsa olmazı Dinamik Analize geçiyoruz. Şimdi bulduğumuz kritik fonksiyonlara breakpoint koyuyoruz ve analiz etmeye başlıyoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-13.png" alt="Matrix Ransomware x64dbg" /></p> <p>Hepsine breakpoint koyduk. GetVolumeInformation fonksiyonuna geldiğinde registerlarda “C:\” ifadesini görüyoruz. Yani direk olarak C dizinini hedef almış. Ama genel olarak Memory Map’e de baktığımız zaman bellekte de analizi zorlaştırmak için bir şifreleme yaptığı ortaya çıkıyor.</p> <p>DeleteFileW fonksiyonuna gelince ise <code class="language-plaintext highlighter-rouge">"C:\Program Files\Windows Mail\wabmig.exe"</code> dosyasına ulaştığını görüyoruz. Windows Mail’i de hedef alıyor.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-14.png" alt="Matrix Ransomware Command Line Çıktıları" /></p> <p>Bu arada masaüstünde iki tane .exe ve bir adet .bat dosyası oluşturduğunu gözlemiyoruz. “.bat” dosyasına baktığımızda ise bazı komutların yer aldığını görüyoruz. Username bilgisine ulaştığını, ve sahipliğini üzerine aldığını, ve başka dizinlere atladığını görüyoruz.</p> <p><code class="language-plaintext highlighter-rouge">FOR /F "UseBackQ Tokens=3,6 delims=: " %%I IN ("umsBf6bj.exe -accepteula %FN% -nobanner") DO (umsBf6bj.exe -accepteula -c %%J -y -p %%I -nobanner)</code></p> <p>Yukarıda kod diziminde ise masaüstünde oluşturduğu .exe dosyasını çalıştırıp parameterler giriyor. EULA’yı da kabul ettiriyor her seferinde. Sysinternals Handle Viewer programının kullanımı otomatikleştirmiş.</p> <p><strong>umsBf6bj.exe</strong> dosyasının UPX ile packlendiğini de ortaya çıkarttık. Şimdi unpack yapıp analiz edelim.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-15.png" alt="Matrix Ransomware Gizli Dosya" /></p> <p>Görüldüğü üzere Multiple koruma yöntemi uygulanmış. Unpack işlemimizi başarıyla gerçekleştirdik. Artık tüm fonksiyonları görebiliriz.</p> <p>umsBf6bj.exe uygulaması, tarihleri alam ve ayarlama, kayıt defteri verilerini okuma, oluşturma ve silme işlemlerini, dosya oluşturma, silme, kriptolama işlemlerini, pointerları encrypt ve decryptleme işlemlerini, loglama işlemlerini yerine getiriyor.</p> <p><strong>NWcxwNQL.exe</strong> dosyayı ise MatrixRansomware.exe’nin kopyası. Fakat aynı ağ üzerinde bulunan diğer sistemleri de tarıyor. Eğer paylaşılan dosya bulursa onu da kriptoluyor.</p> <p>umsBf6bj.exe dosyasının Resource’larına baktığımızda Sysinternals Handle Viewer programını görüyoruz. Dosyalara erişebilmek ve sahibini görüntülemek için Windows’un kendi uygulaması kullanılmış.</p> <p>Wireshark ile detaylı ağ analizi yaptığımızda ise <strong>eman.mygoodsday[.]org</strong> komuta kontrol sunucusu bulunmuştur. Fakat artık böyle bir komuta kontrol sunucusunun mevcut olmadığı tespit edilmiştir.</p> <h3 id="sonsöz"> <a href="#sonsöz" class="anchor-head"></a> Sonsöz </h3> <p>MatrixRansomware’ı olabildiğince analiz etmeye çalıştım. Resource’larda ve memory’de şifreleme kullanıldığı için bazı önemli verilere ulaşamadım. Bu analiz raporu ilerleyen günlerde güncellenecektir.</p> </div> </article> <div class="comments"> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'fatihsensoy'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/Hell0_W0rlD/" > <div class="nav-arrow">Previous</div> <span class="post-title">Hell0_W0rlD!</span> </a> <a class="post-nav-item post-nav-next" href="/HackIstanbul-Anisi/"> <div class="nav-arrow">Next</div> <span class="post-title">HackIstanbul'19 Anısı</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="mailto:iletisim@fatihsensoy.com">Contact Me 📧</a> <a class="footer_item" href="/feed.xml">RSS</a> <small class="footer_copyright"> <span class="footer_item">Fatih Şensoy &copy;2021</span> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155173124-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-155173124-1'); </script> </div> </div> </body> </html>
