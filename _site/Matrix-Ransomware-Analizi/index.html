<!DOCTYPE html> <html lang="tr-TR"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Fatih Åensoy" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Fatih Åensoy" /> <title> Matrix Ransomware Analizi (GiriÅŸ Seviye) - Fatih Åensoy </title> <link rel="alternate" href="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" hreflang="tr-TR" /> <link rel="canonical" href="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta name="description" content="Matrix Ransomware, dÃ¼nyada bir Ã§ok tÃ¼revi bulunan bir fidye yazÄ±lÄ±mÄ±dÄ±r. Bizim incelediÄŸimiz tÃ¼rev baÅŸka hiÃ§bir yerde incelenmemiÅŸtir. â€œ.emanâ€ uzantÄ±sÄ±nda dosyalarÄ± kriptolamaktadÄ±r." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Matrix Ransomware Analizi (GiriÅŸ Seviye) | " /> <meta property="og:title" content="Matrix Ransomware Analizi (GiriÅŸ Seviye) | " /> <meta property="og:type" content="website" /> <meta property="og:url" content="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta property="og:description" content="Matrix Ransomware, dÃ¼nyada bir Ã§ok tÃ¼revi bulunan bir fidye yazÄ±lÄ±mÄ±dÄ±r. Bizim incelediÄŸimiz tÃ¼rev baÅŸka hiÃ§bir yerde incelenmemiÅŸtir. â€œ.emanâ€ uzantÄ±sÄ±nda dosyalarÄ± kriptolamaktadÄ±r." /> <meta property="og:image" content="https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Matrix Ransomware Analizi (GiriÅŸ Seviye) | fatihsnsy" /> <meta name="twitter:url" content="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta name="twitter:site" content="@fatihsnsy" /> <meta name="twitter:creator" content="@fatihsnsy" /> <meta name="twitter:description" content="Matrix Ransomware, dÃ¼nyada bir Ã§ok tÃ¼revi bulunan bir fidye yazÄ±lÄ±mÄ±dÄ±r. Bizim incelediÄŸimiz tÃ¼rev baÅŸka hiÃ§bir yerde incelenmemiÅŸtir. â€œ.emanâ€ uzantÄ±sÄ±nda dosyalarÄ± kriptolamaktadÄ±r." /> <meta name="twitter:image" content="https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png" /> <link type="application/atom+xml" rel="alternate" href="https://fatihsensoy.com/feed.xml" title="Fatih Åensoy" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/fav-32.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Matrix Ransomware Analizi (GiriÅŸ Seviye) | Fatih Åensoy</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="Matrix Ransomware Analizi (GiriÅŸ Seviye)" /> <meta name="author" content="Fatih ÅENSOY" /> <meta property="og:locale" content="tr_TR" /> <meta name="description" content="Matrix Ransomware, dÃ¼nyada bir Ã§ok tÃ¼revi bulunan bir fidye yazÄ±lÄ±mÄ±dÄ±r. Bizim incelediÄŸimiz tÃ¼rev baÅŸka hiÃ§bir yerde incelenmemiÅŸtir. â€œ.emanâ€ uzantÄ±sÄ±nda dosyalarÄ± kriptolamaktadÄ±r." /> <meta property="og:description" content="Matrix Ransomware, dÃ¼nyada bir Ã§ok tÃ¼revi bulunan bir fidye yazÄ±lÄ±mÄ±dÄ±r. Bizim incelediÄŸimiz tÃ¼rev baÅŸka hiÃ§bir yerde incelenmemiÅŸtir. â€œ.emanâ€ uzantÄ±sÄ±nda dosyalarÄ± kriptolamaktadÄ±r." /> <link rel="canonical" href="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta property="og:url" content="https://fatihsensoy.com/Matrix-Ransomware-Analizi/" /> <meta property="og:site_name" content="Fatih Åensoy" /> <meta property="og:image" content="https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-12-30T15:20:00+00:00" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png" /> <meta property="twitter:title" content="Matrix Ransomware Analizi (GiriÅŸ Seviye)" /> <script type="application/ld+json"> {"@type":"BlogPosting","image":"https://fatihsensoy.com/assets/img/matrix-ransomware-analizi/img/cover.png","headline":"Matrix Ransomware Analizi (GiriÅŸ Seviye)","dateModified":"2019-12-30T15:20:00+00:00","datePublished":"2019-12-30T15:20:00+00:00","url":"https://fatihsensoy.com/Matrix-Ransomware-Analizi/","mainEntityOfPage":{"@type":"WebPage","@id":"https://fatihsensoy.com/Matrix-Ransomware-Analizi/"},"author":{"@type":"Person","name":"Fatih ÅENSOY"},"description":"Matrix Ransomware, dÃ¼nyada bir Ã§ok tÃ¼revi bulunan bir fidye yazÄ±lÄ±mÄ±dÄ±r. Bizim incelediÄŸimiz tÃ¼rev baÅŸka hiÃ§bir yerde incelenmemiÅŸtir. â€œ.emanâ€ uzantÄ±sÄ±nda dosyalarÄ± kriptolamaktadÄ±r.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Anasayfa</a><a class="menu-link" href="/archive/">ArÅŸiv</a><a class="menu-link" href="/about/">HakkÄ±mda</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="main_wrapper"> <div class="toc_wrapper"> <div class="toc_content"> <h2>Ä°Ã§erik</h2> <ul><li><a href="#iÌ‡lk-bakÄ±ÅŸ">Ä°lk BakÄ±ÅŸ</a></li><li><a href="#statik-analiz">Statik Analiz</a></li><li><a href="#derinlere-iÌ‡nelim">Derinlere Ä°nelim</a></li><li><a href="#cff-explorer">CFF Explorer</a></li><li><a href="#dinamik-analize-geÃ§elim">Dinamik Analize GeÃ§elim</a></li><li><a href="#sonsÃ¶z">SonsÃ¶z</a></li></ul> </div> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"></article> <header class="header"> <img src="/assets/img/matrix-ransomware-analizi/img/cover.png" alt="" style="border: 2px solid white; width: 100%;"><br><br> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#malware">MALWARE</a>, <a class="tag" href="/tags/#malware-analysis">MALWARE ANALYSIS</a>, <a class="tag" href="/tags/#matrix-ransomware">MATRIX RANSOMWARE</a> </span> </div> <h1 class="header-title" itemprop="headline">Matrix Ransomware Analizi (GiriÅŸ Seviye)</h1> <div class="post-meta"> <time datetime="2019-12-30T15:20:00+00:00" itemprop="datePublished"> Dec 30, 2019 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Fatih ÅENSOY</span> </span> <time hidden datetime="" itemprop="dateModified"> Dec 30, 2019 </time> <span hidden itemprop="publisher" itemtype="Person">Fatih ÅENSOY</span> <span hidden itemprop="image">/assets/img/matrix-ransomware-analizi/img/cover.png</span> <span hidden itemprop="mainEntityOfPage"><p>Selamlar herkese. Matrix Ransomware analiz raporumu sizlere paylaÅŸÄ±yorum. Bu benim Malware AnalistliÄŸi kariyerimde yazdÄ±ÄŸÄ±m ilk raporum Ã¼nvanÄ±nÄ± taÅŸÄ±yor. DiÄŸerlerini de belirli aralÄ±klarla sizlerle paylaÅŸmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorum :)</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>Selamlar herkese. Matrix Ransomware analiz raporumu sizlere paylaÅŸÄ±yorum. Bu benim Malware AnalistliÄŸi kariyerimde yazdÄ±ÄŸÄ±m ilk raporum Ã¼nvanÄ±nÄ± taÅŸÄ±yor. DiÄŸerlerini de belirli aralÄ±klarla sizlerle paylaÅŸmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorum :)</p> <p>Matrix Ransomware, dÃ¼nyada bir Ã§ok tÃ¼revi bulunan bir fidye yazÄ±lÄ±mÄ±dÄ±r. Bizim incelediÄŸimiz tÃ¼rev baÅŸka hiÃ§bir yerde incelenmemiÅŸtir. â€œ.emanâ€ uzantÄ±sÄ±nda dosyalarÄ± kriptolamaktadÄ±r.</p> <table> <thead> <tr> <th style="text-align: center">SHA-256</th> <th style="text-align: center">MD5</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">242713ef2f372f0d39ca8f01bd09c9f99bcfe850e156621c023dd9e0bfb9bd95</td> <td style="text-align: center">A93BD199D34D21CC9102600C6CE782CF</td> </tr> </tbody> </table> <h3 id="iÌ‡lk-bakÄ±ÅŸ"> <a href="#iÌ‡lk-bakÄ±ÅŸ" class="anchor-head"></a> Ä°lk BakÄ±ÅŸ </h3> <p><strong>MatrixRansomware.exe</strong> isimli dosyanÄ±n orijinal adÄ± <strong>eman33.exe</strong> olarak internet ortamÄ±nda dolaÅŸÄ±yor. MatrixRansomwareâ€™Ä±n farklÄ± farklÄ± tÃ¼revleri mevcut ve sÃ¼rekli geliÅŸim halinde. Ben analizde anlaÅŸÄ±lmasÄ± adÄ±na ismini dÃ¼zenledim. Åimdi ilk olarak bu ransomwareâ€™Ä±n yeteneklerini gÃ¶rmek iÃ§in gelin bir laboratuvar ortamÄ±mÄ±zda test edelim.</p> <p>Ã–ncelikle MatrixRansomware.exe isimli dosyamÄ±zÄ± kullanÄ±cÄ± yetkilerinde Ã§alÄ±ÅŸtÄ±rÄ±yoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-1.png" alt="Matrix Ransomware Ä°lk BakÄ±ÅŸ" /></p> <p>Ã‡alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mÄ±zda masaÃ¼stÃ¼mÃ¼zde dosyalar oluÅŸtuÄŸunu ve iki adet komut satÄ±rÄ± ekranÄ± aÃ§Ä±ldÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz. Laboratuvar ortamÄ±mÄ±z aÄŸa baÄŸlÄ±.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-2.png" alt="Matrix Ransomware Ä°lk AÃ§Ä±lÄ±ÅŸ" /></p> <p>GÃ¶rÃ¼ldÃ¼ÄŸÃ¼ Ã¼zere Ã¶ne Ã§Ä±kan komut satÄ±rÄ±nÄ±n en Ã¼stÃ¼nde SHARESSCAN ibaresi yer alÄ±yor. Yani ÅŸuan paylaÅŸÄ±lan klasÃ¶rleri geziyor. AÄŸÄ±mÄ±zdaki diÄŸer bilgisayarlara ulaÅŸmak iÃ§in IP bloÄŸumuzdan hareket ediyor. DiÄŸer Command Line penceremizde ise bazÄ± bilgilerin yer aldÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-3.png" alt="Matrix Ransomware Ä°lk Tetikleme" /></p> <p>Integrity seviyesini numaralandÄ±rdÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz ve ÅŸuan da 3 seviyesinde. Yani program USER yetkilerinde Ã§alÄ±ÅŸÄ±yor.Â </p> <p>LDRIVES kÄ±smÄ±na baktÄ±ÄŸÄ±mÄ±zda ise C: dizinini direk olarak hedef aldÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz. Ve dosyalarÄ±mÄ±zÄ± kriptolarken anlÄ±k olarak sistemimizin performansÄ±na gÃ¶re kriptolama hÄ±zÄ±nÄ± gÃ¶steren bir ibare de mevcut.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-4.png" alt="Matrix Ransomware KullanÄ±cÄ± Yetkilerinde OluÅŸturulan Dosyalar" /></p> <p>MasaÃ¼stÃ¼ne kullanÄ±cÄ± yetkilerinde iken oluÅŸturduÄŸu dosyalar gÃ¶rselde mevcuttur.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-5.png" alt="Matrix Ransomware elog Dosya Ä°Ã§eriÄŸi" /></p> <p><strong>elog_0940325A9D85363B.txt</strong> dosyasÄ±nÄ± aÃ§tÄ±ÄŸÄ±mÄ±zda ise loglarÄ± gÃ¶rÃ¼yoruz. Ransomwareâ€™Ä±mÄ±z kullanÄ±cÄ± yetkilerinde olduÄŸu iÃ§in dosyalara eriÅŸememiÅŸ ve bir ÅŸifreleme yapamamÄ±ÅŸ.</p> <p>Åimdi ise Admin yetkilerinde malwareâ€™imizi Ã§alÄ±ÅŸtÄ±ralÄ±m.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-6.png" alt="Matrix Ransomware Admin Yetkileri" /></p> <p>Yine aynÄ± iÅŸlemleri yaptÄ± ve komut ekranÄ± kapandÄ±. KapanÄ±rken ise iÅŸlemin tamamlandÄ±ÄŸÄ±na dair bir bilgi verdi. MasaÃ¼stÃ¼nde yine birkaÃ§ dosya oluÅŸturdu ama bu sefer dosyalarÄ±mÄ±zÄ± kriptolamÄ±ÅŸtÄ± ve **#README_EMAN#.rtf **adÄ±nda bir dosya oluÅŸturmuÅŸtu.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-7.png" alt="Matrix Ransomware Admin Yetkilerinde OluÅŸturulan Dosyalar" /></p> <p>DosyayÄ± aÃ§tÄ±ÄŸÄ±mÄ±zda bize, dosyalarÄ±mÄ±zÄ± nasÄ±l kurtaracaÄŸÄ±mÄ±za dair bir yÃ¶nerge gÃ¶steriyordu. SaldÄ±rgan ile nasÄ±l iletiÅŸime geÃ§ileceÄŸinin bilgisi mevcuttu. Hatta gÃ¼ven saÄŸlamak iÃ§in saldÄ±rganlara yollayacaÄŸÄ±mÄ±z 3 adet kriptolanmÄ±ÅŸ veriyi decrypt edip geri vereceklerini sÃ¶ylÃ¼yorlardÄ±.</p> <p>Ä°lk bakÄ±ÅŸÄ±mÄ±z bu ÅŸekilde sona erdi. ZararlÄ± yazÄ±lÄ±mÄ±n ne yaptÄ±ÄŸÄ± hakkÄ±nda genel bir bilgi sahibi olduk. Åimdi ise bir sonraki adÄ±mÄ±mÄ±za, yani STATÄ°K ANALÄ°ZE geÃ§elim.</p> <h3 id="statik-analiz"> <a href="#statik-analiz" class="anchor-head"></a> Statik Analiz </h3> <p>IDA ile statik analizimizi yapÄ±yoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-8.png" alt="IDA Ä°lk BakÄ±ÅŸ" /></p> <p>Herhangi bir main fonksiyonunun olmadÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz. AslÄ±nda var ama malwareâ€™Ä± geliÅŸtiren kiÅŸiler analizi zorlaÅŸtÄ±rmak iÃ§in adÄ±nÄ± deÄŸiÅŸtirmiÅŸ veya malwareâ€™i packlemiÅŸ olabilirler. Pack detection toollarÄ± ile tarama yapÄ±ldÄ±ÄŸÄ±nda da herhangi bir pack iÅŸleminin olmadÄ±ÄŸÄ±nÄ± gÃ¶rdÃ¼k. Malwareâ€™Ä±n <strong>3700</strong>â€™den fazla fonksiyonu mevcut.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-9.png" alt="Matrix Ransomware Hex Ve String" /></p> <p>Statik analize devam ettiÄŸimizde ise Strings ve Hex GÃ¶rÃ¼ntÃ¼sÃ¼ pencerelerine gÃ¶z attÄ±ÄŸÄ±mÄ±zda ise bazÄ± kritik bulgulara ulaÅŸÄ±yoruz. Bunlar indikatÃ¶rlere ulaÅŸmamÄ±zÄ± saÄŸlayacak.</p> <p>Bulunan Kritik Ve Ã–nemli Bulgular</p> <ul> <li>Varolan iÅŸlemlerin diline bakarak kullanÄ±cÄ±nÄ±n sisteminin dilini Ã¶ÄŸrenmeye Ã§alÄ±ÅŸÄ±yor.</li> <li>WSAStartup, bind, accept, connect gibi parametreler Soket Programlamaâ€™dan tanÄ±dÄ±k geliyor. Yani bu malware bir uzak sunucu ile baÄŸlantÄ± kuruyor.</li> <li>Listen, accept ve send parametleri de mevcut. Hem veri alÄ±yor, hem de veri gÃ¶nderimi yapÄ±yor.</li> <li>Basic seviyede Proxy-Authorization mekanizmasÄ± kullanÄ±yor.</li> </ul> <p>Åimdi ise bu malwareâ€™Ä±n neleri import ettiÄŸine bakÄ±yoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-10.png" alt="Matrix Ransomware Importlar" /></p> <p><strong>Kernel32</strong> ve <strong>wsock32</strong> gibi kritik kÃ¼tÃ¼phaneleri kullanÄ±yor. Wsock32 kÃ¼tÃ¼phanesi import etmesinden de anlayabileceÄŸimiz Ã¼zere bir sunucu ile iletiÅŸimde olduÄŸu bulgularÄ±mÄ±zÄ± doÄŸrulamÄ±ÅŸ olduk. KÃ¼tÃ¼phanelerden ise kullandÄ±ÄŸÄ± fonksiyonlara gÃ¶z atalÄ±m.</p> <p><strong>DeleteFileW</strong> fonksiyonunu dahil etmiÅŸ. Yani mesajda bize verdiÄŸi <strong>7 gÃ¼nlÃ¼k</strong> sÃ¼renin sonunda iletiÅŸime geÃ§ilmezse gerÃ§ekten de ÅŸifrelenmiÅŸ dosyalarÄ± siliyor.</p> <p><strong>CreateMutexW</strong> fonksiyonu ile de Mutex mekanizmasÄ± kullanÄ±yor. Yani Mutexâ€™i C dilinde yazÄ±p Ã§alÄ±ÅŸtÄ±rÄ±rsak, malware â€œMutex var ise Ã§alÄ±ÅŸmaâ€ prensibinden dolayÄ± bir daha Ã§alÄ±ÅŸtÄ±rÄ±rsak sistemi ÅŸifrelemeyecek.</p> <p><strong>CryptGenRandom</strong> fonksiyonu ile de bir arabelleÄŸi kriptografik baytlar ile dolduruyor.</p> <h3 id="derinlere-iÌ‡nelim"> <a href="#derinlere-iÌ‡nelim" class="anchor-head"></a> Derinlere Ä°nelim </h3> <p>IDA ile biraz daha ayrÄ±ntÄ±ya iniyoruz. <strong>FindFirstFileW</strong> fonksiyonu ile belirli bir uzantÄ±daki dosyalarÄ± aradÄ±ÄŸÄ±nÄ± anlÄ±yoruz. Biraz daha derin analiz yapÄ±ldÄ±ÄŸÄ±nda ransomwareâ€™in kriptoladÄ±ÄŸÄ± uzantÄ±lar aÅŸaÄŸÄ±daki gibidir:</p> <ul> <li>.cmd</li> <li>.bat</li> <li>.vbs</li> <li>.ink</li> <li>.rtf</li> <li>.bmp</li> <li>.tmp</li> </ul> <p>32-bit ve 64-bit sistemler iÃ§in ayrÄ± ayrÄ± iÅŸlemler yapÄ±yor.</p> <p>Disassembly kodlarÄ±nda** log.txt**â€™nin de oluÅŸturulduÄŸunu gÃ¶rÃ¼yoruz.</p> <p><strong>nw.exe</strong> adlÄ± programÄ±n â€“n parametresi ile bir iÅŸlem yapÄ±yor ve nw.exe aÄŸ ve Javascript kÃ¼tÃ¼phaneleri iÃ§eren bir program olarak biliniyor. Genelde adware yazÄ±lÄ±mlar iÃ§in kullanÄ±lÄ±yor.</p> <p>â€œ%d.%d.%d.%dâ€ ile aynÄ± aÄŸda bulunan diÄŸer sistemleri tarayarak IP adreslerini CMD ekranÄ±nda kullanÄ±cÄ±ya gÃ¶steriyor.</p> <p>80, 443, 21 gibi portlar da zararlÄ±ya tanÄ±mlanmÄ±ÅŸ.</p> <p>Malware, bulaÅŸma zamanlarÄ±nÄ± hesaplayarak 7 gÃ¼nlÃ¼k silme sÃ¼recini baÅŸlatÄ±yor. BilgisayarÄ±n ve mevcut kullanÄ±cÄ±nÄ±n adÄ±nÄ± da tanÄ±mlama yapmak amacÄ±yla alÄ±yor. flcCipherRSA ibaresinden dosyalarÄ±n RSA ile kriptolandÄ±ÄŸÄ±nÄ± anlÄ±yoruz.</p> <p>AyrÄ±ca bir URLâ€™e HTTP verisi gÃ¶nderildiÄŸini tespit ettim. HTTP baÅŸlÄ±klarÄ±nÄ± ayarlÄ±yor. â€œ<strong>set-cookie, Content-Lenght, Content-Type</strong>â€ gibi standart HTTP Head bilgilerini de yolluyor. Cookie set etmesinden bir kullanÄ±cÄ± tanÄ±mlama mekanizmasÄ± yaptÄ±ÄŸÄ± ihtimali gÃ¼Ã§leniyor.</p> <p>Komuta kontrol sunucusuna (URLâ€™e) yolladÄ±ÄŸÄ± parametreler ise dikkat Ã§ekici:</p> <ul> <li>/addrecord.php?apikey=</li> <li>&amp;compuser=</li> <li>&amp;sid=</li> <li>&amp;phase=</li> </ul> <p>ArdÄ± ardÄ±na birleÅŸtirme operatÃ¶rÃ¼nÃ¼ kullanarak (&amp;) bir istek gÃ¶nderiyor. Burada da her kullanÄ±cÄ±yÄ± tanÄ±mlamak iÃ§in bir mekanizma oluÅŸturduÄŸu ihtimalini kanÄ±tlamÄ±ÅŸ oluyoruz.</p> <p>AyrÄ±ca user-agent olarak â€œ<strong>Mozilla/4.0 (compatible; Synapse)</strong>â€ ayarlÄ±yor.</p> <h3 id="cff-explorer"> <a href="#cff-explorer" class="anchor-head"></a> CFF Explorer </h3> <p>Daha iyi analizle yapmak iÃ§in CFF Explorerâ€™da da analiz ediyoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-11.png" alt="CFF Explorer Ä°lk BakÄ±ÅŸ" /></p> <p>Section Headersâ€™lara baktÄ±ÄŸÄ±mÄ±zda standart MZ baÅŸlÄ±ÄŸÄ± yerine <strong>MZP</strong> baÅŸlÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz. Yani bu ransomware <strong>Pascal</strong> ile yazÄ±lmÄ±ÅŸ!</p> <p>Analizin geÃ§en kÄ±sÄ±mlarÄ±nda ise Borland Delphi 3.0 IDEâ€™sini kullandÄ±ÄŸÄ±nÄ± da tespit etmiÅŸtik.</p> <p>Import Directoryâ€™ye geldiÄŸimizde ise malwareâ€™Ä±n etkisini ciddi derecede gÃ¶rebiliyoruz. Import ettiÄŸi dllâ€™ler ve fonksiyonlarÄ±nda kritik seviyede bulunanlar ÅŸu ÅŸekilde:</p> <ul> <li>GetSystemInfo</li> <li>GetProcAddress</li> <li>CreateThread</li> <li>CreateMutexW</li> <li>GetVolumeInformationW</li> <li>GetDiskFreeSpace</li> <li>DeleteFileW</li> <li>gethostname</li> <li>gethostbyname</li> </ul> <p>YukarÄ±daki fonksiyonlara baktÄ±ÄŸÄ±mÄ±zda;</p> <ul> <li>sistemin bilgilerini alabildiÄŸi,</li> <li>bir iÅŸlemin adresini alabildiÄŸi,</li> <li>bir iÅŸ parÃ§acÄ±ÄŸÄ± oluÅŸturabildiÄŸi,</li> <li>bir Mutex nesnesi oluÅŸturabildiÄŸi,</li> <li>Dosya sistemi ve hacmine eriÅŸebildiÄŸi,</li> <li>BoÅŸ alana eriÅŸebildiÄŸi,</li> <li>Ve en kritiÄŸi olan DOSYALARI SÄ°LEBÄ°LDÄ°ÄÄ° gÃ¶zlemlenmiÅŸtir.</li> </ul> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-12.png" alt="Matrix Ransomware Resource" /></p> <p>DosyanÄ±n iÃ§indeki kaynaklarda ise iki kÄ±smÄ±n olduÄŸu tespit edilmiÅŸtir. Strings Tables ve RCData. Strings Tablesâ€™da aylarÄ±n isimleri vs. olduÄŸu gÃ¶zlemlenmiÅŸtir. RCData kÄ±smÄ±nda ise farklÄ± farklÄ± kaynaklar olduÄŸu gÃ¶rÃ¼lmektedir.</p> <p>Fakat eriÅŸilmeye Ã§alÄ±ÅŸÄ±ldÄ±ÄŸÄ±nda bozuk bir ASCII Ã§Ä±ktÄ±sÄ± bizi karÅŸÄ±lamaktadÄ±r. Buradan yapÄ±lan Ã§Ä±karÄ±mla <strong>RCData</strong> kaynaÄŸÄ±nÄ±n iÃ§inde Ã§ok Ã¶nemli bilgilerin olduÄŸu ve okunamamasÄ± iÃ§in de Ã¶zel bir ÅŸifreleme tÃ¼rÃ¼ ile ÅŸifrelendiÄŸi ortaya Ã§Ä±kmaktadÄ±r.</p> <h3 id="dinamik-analize-geÃ§elim"> <a href="#dinamik-analize-geÃ§elim" class="anchor-head"></a> Dinamik Analize GeÃ§elim </h3> <p>Statik analizde bir Ã§ok Ã¶nemli veriyi ele geÃ§irmeyi baÅŸardÄ±k. Åimdi ise bize kritik bilgileri verecek olan, bir Malware Analizinin olmazsa olmazÄ± Dinamik Analize geÃ§iyoruz. Åimdi bulduÄŸumuz kritik fonksiyonlara breakpoint koyuyoruz ve analiz etmeye baÅŸlÄ±yoruz.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-13.png" alt="Matrix Ransomware x64dbg" /></p> <p>Hepsine breakpoint koyduk. GetVolumeInformation fonksiyonuna geldiÄŸinde registerlarda â€œC:\â€ ifadesini gÃ¶rÃ¼yoruz. Yani direk olarak C dizinini hedef almÄ±ÅŸ. Ama genel olarak Memory Mapâ€™e de baktÄ±ÄŸÄ±mÄ±z zaman bellekte de analizi zorlaÅŸtÄ±rmak iÃ§in bir ÅŸifreleme yaptÄ±ÄŸÄ± ortaya Ã§Ä±kÄ±yor.</p> <p>DeleteFileW fonksiyonuna gelince ise <code class="language-plaintext highlighter-rouge">"C:\Program Files\Windows Mail\wabmig.exe"</code> dosyasÄ±na ulaÅŸtÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz. Windows Mailâ€™i de hedef alÄ±yor.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-14.png" alt="Matrix Ransomware Command Line Ã‡Ä±ktÄ±larÄ±" /></p> <p>Bu arada masaÃ¼stÃ¼nde iki tane .exe ve bir adet .bat dosyasÄ± oluÅŸturduÄŸunu gÃ¶zlemiyoruz. â€œ.batâ€ dosyasÄ±na baktÄ±ÄŸÄ±mÄ±zda ise bazÄ± komutlarÄ±n yer aldÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz. Username bilgisine ulaÅŸtÄ±ÄŸÄ±nÄ±, ve sahipliÄŸini Ã¼zerine aldÄ±ÄŸÄ±nÄ±, ve baÅŸka dizinlere atladÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼yoruz.</p> <p><code class="language-plaintext highlighter-rouge">FOR /F "UseBackQ Tokens=3,6 delims=: " %%I IN ("umsBf6bj.exe -accepteula %FN% -nobanner") DO (umsBf6bj.exe -accepteula -c %%J -y -p %%I -nobanner)</code></p> <p>YukarÄ±da kod diziminde ise masaÃ¼stÃ¼nde oluÅŸturduÄŸu .exe dosyasÄ±nÄ± Ã§alÄ±ÅŸtÄ±rÄ±p parameterler giriyor. EULAâ€™yÄ± da kabul ettiriyor her seferinde. Sysinternals Handle Viewer programÄ±nÄ±n kullanÄ±mÄ± otomatikleÅŸtirmiÅŸ.</p> <p><strong>umsBf6bj.exe</strong> dosyasÄ±nÄ±n UPX ile packlendiÄŸini de ortaya Ã§Ä±karttÄ±k. Åimdi unpack yapÄ±p analiz edelim.</p> <p><img src="/assets/img/matrix-ransomware-analizi/img/matrix-15.png" alt="Matrix Ransomware Gizli Dosya" /></p> <p>GÃ¶rÃ¼ldÃ¼ÄŸÃ¼ Ã¼zere Multiple koruma yÃ¶ntemi uygulanmÄ±ÅŸ. Unpack iÅŸlemimizi baÅŸarÄ±yla gerÃ§ekleÅŸtirdik. ArtÄ±k tÃ¼m fonksiyonlarÄ± gÃ¶rebiliriz.</p> <p>umsBf6bj.exe uygulamasÄ±, tarihleri alam ve ayarlama, kayÄ±t defteri verilerini okuma, oluÅŸturma ve silme iÅŸlemlerini, dosya oluÅŸturma, silme, kriptolama iÅŸlemlerini, pointerlarÄ± encrypt ve decryptleme iÅŸlemlerini, loglama iÅŸlemlerini yerine getiriyor.</p> <p><strong>NWcxwNQL.exe</strong> dosyayÄ± ise MatrixRansomware.exeâ€™nin kopyasÄ±. Fakat aynÄ± aÄŸ Ã¼zerinde bulunan diÄŸer sistemleri de tarÄ±yor. EÄŸer paylaÅŸÄ±lan dosya bulursa onu da kriptoluyor.</p> <p>umsBf6bj.exe dosyasÄ±nÄ±n Resourceâ€™larÄ±na baktÄ±ÄŸÄ±mÄ±zda Sysinternals Handle Viewer programÄ±nÄ± gÃ¶rÃ¼yoruz. Dosyalara eriÅŸebilmek ve sahibini gÃ¶rÃ¼ntÃ¼lemek iÃ§in Windowsâ€™un kendi uygulamasÄ± kullanÄ±lmÄ±ÅŸ.</p> <p>Wireshark ile detaylÄ± aÄŸ analizi yaptÄ±ÄŸÄ±mÄ±zda ise <strong>eman.mygoodsday[.]org</strong> komuta kontrol sunucusu bulunmuÅŸtur. Fakat artÄ±k bÃ¶yle bir komuta kontrol sunucusunun mevcut olmadÄ±ÄŸÄ± tespit edilmiÅŸtir.</p> <h3 id="sonsÃ¶z"> <a href="#sonsÃ¶z" class="anchor-head"></a> SonsÃ¶z </h3> <p>MatrixRansomwareâ€™Ä± olabildiÄŸince analiz etmeye Ã§alÄ±ÅŸtÄ±m. Resourceâ€™larda ve memoryâ€™de ÅŸifreleme kullanÄ±ldÄ±ÄŸÄ± iÃ§in bazÄ± Ã¶nemli verilere ulaÅŸamadÄ±m. Bu analiz raporu ilerleyen gÃ¼nlerde gÃ¼ncellenecektir.</p> </div> </article> <div class="comments"> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'fatihsensoy'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/Hell0_W0rlD/" > <div class="nav-arrow">Previous</div> <span class="post-title">Hell0_W0rlD!</span> </a> <a class="post-nav-item post-nav-next" href="/HackIstanbul-Anisi/"> <div class="nav-arrow">Next</div> <span class="post-title">HackIstanbul'19 AnÄ±sÄ±</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="mailto:iletisim@fatihsensoy.com">Contact Me ğŸ“§</a> <a class="footer_item" href="/feed.xml">RSS</a> <small class="footer_copyright"> <span class="footer_item">Fatih Åensoy &copy;2021</span> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155173124-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-155173124-1'); </script> </div> </div> </body> </html>
